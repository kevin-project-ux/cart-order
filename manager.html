<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>新增團購品項</title>
  <!-- Bootstrap & Font Awesome -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
  
  <!-- Flatpickr -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
  <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
  <script src="https://cdn.jsdelivr.net/npm/flatpickr/dist/l10n/zh.js"></script>
</head>
<script>
  window.onload = async () => {
    await liff.init({ liffId: "2007457926-5wAYNP0w" });

    if (!liff.isLoggedIn()) {
      liff.login();
      return;
    }

    const profile = await liff.getProfile();
    // console.log("✅ userId:", profile.userId);
    userId = profile.userId;
    userName = profile.displayName;
    document.getElementById("createOrder").disabled = false;
  }
</script>
<body>
  <div class="container mt-4">
    <h4>建立新團購品項</h4>
    <div class="mb-3">
      <label class="form-label"><span class="req">*</span> 品項名稱</label>
      <input type="text" class="form-control" id="itemName" required>
    </div>

    <div class="mb-3">
      <label class="form-label"><span class="req">*</span> 價格（NT$）</label>
      <input type="number" class="form-control" id="price" min="1" required>
    </div>

    <div class="mb-3">
      <label class="form-label">團購期間 </label>
      <input type="text" class="form-control" id="rangePicker" placeholder="請選擇時間範圍" style="margin-top: 0.4rem;">
    </div>

    <!-- 單/多口味切換 -->
    <div class="mb-3">
      <label class="form-label">口味選擇</label><br>
      <div class="form-check form-check-inline">
        <input class="form-check-input" type="radio" name="flavorType" value="single" checked onchange="toggleFlavor()">
        <label class="form-check-label">單口味</label>
      </div>
      <div class="form-check form-check-inline">
        <input class="form-check-input" type="radio" name="flavorType" value="multiple" onchange="toggleFlavor()">
        <label class="form-check-label">多口味</label>
      </div>
    </div>

    <!-- 單口味 -->
  <div id="singleFlavor" class="mb-3">
    <label class="form-label">限量數量</label>
    <input type="number" class="form-control" id="singleLimit" placeholder="輸入限量數量">
  </div>

  <!-- 多口味 -->
  <div id="multiFlavor" class="mb-3" style="display: none;">
    <label class="form-label">口味與限量</label>
    <div id="flavorWrapper">
      <div class="row g-2 mb-2 flavor-row">
        <div class="col">
          <input type="text" class="form-control flavor-name" placeholder="口味名稱">
        </div>
        <div class="col">
          <input type="number" class="form-control flavor-limit" placeholder="數量">
        </div>
        <div class="col-auto">
          <button class="btn btn-outline-danger" onclick="removeFlavor(this)">
            <i class="fas fa-times"></i>
          </button>
        </div>
      </div>
    </div>
    <button class="btn btn-outline-primary w-100" onclick="addFlavor()">
      <i class="fas fa-plus"></i> 新增口味
    </button>
  </div>

    <label for="note">備註</label>
    <input type="text" id="note" />

    <button class="btn btn-success w-100" id="createOrder" onclick="submitCreateCart()">建立團購</button>
  </div>
</body>
<script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<script>

  flatpickr("#rangePicker", {
    mode: "range",
    enableTime: true,
    dateFormat: "Y-m-d H:i",
    locale: "zh",
    minDate: "today" // ✅ 限制今天以前不能選
  });

  function toggleFlavor() {
    const selected = document.querySelector('input[name="flavorType"]:checked').value;
    document.getElementById("singleFlavor").style.display = selected === "single" ? "block" : "none";
    document.getElementById("multiFlavor").style.display = selected === "multiple" ? "block" : "none";
  }

  function addFlavor() {
    const div = document.createElement('div');
    div.className = "flavor-row";
    div.innerHTML = `
      <input type="text" placeholder="口味名稱" class="flavor-name">
      <input type="number" placeholder="數量" class="flavor-limit">
      <button class="icon-btn" onclick="removeFlavor(this)"><i class="fas fa-times"></i></button>
    `;
    document.getElementById("flavorWrapper").appendChild(div);
  }

  function removeFlavor(btn) {
    btn.parentElement.remove();
  }
  
  async function submitCreateCart() {

    if (!userId) {
      alert("⚠️ 尚未取得 userId");
      return;
    }
  }
</script>
</html>
