<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Vue 2 + FullCalendar</title>

	<script src="https://cdn.jsdelivr.net/npm/vue@2/dist/vue.js"></script>

	<!-- FullCalendar CSS & JS -->
	<link href="https://cdn.jsdelivr.net/npm/fullcalendar@5.11.3/main.min.css" rel="stylesheet">
	<script src="https://cdn.jsdelivr.net/npm/fullcalendar@5.11.3/main.min.js"></script>

	<!-- Firebase -->
	<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
	<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
</head>
<style>
    #calendar { max-width: 900px; margin: 40px auto; }
</style>
<body>

<div id="app">
	<h1>{{ msg }}</h1>
	<div id="calendar"></div>
</div>

<script>

	// -----------------------------
	// 1. Firebase Init
	// -----------------------------
	var firebaseConfig = {
		apiKey: "AIzaSyC8m836pO-wSSshMj3tx_C3FPLCmPF4O6Y",
        authDomain: "fir-55dbc.firebaseapp.com",
        databaseURL: "https://fir-55dbc-default-rtdb.firebaseio.com",
        projectId: "fir-55dbc",
        storageBucket: "fir-55dbc.appspot.com",
        messagingSenderId: "545726793239",
        appId: "1:545726793239:web:94567930a3b2a55d5efe52",
        measurementId: "G-R5XS993882"
	};

	firebase.initializeApp(firebaseConfig);

	var db = firebase.database();
	new Vue({
		el: '#app',
		data: {
			msg: ''
		},
		methods: {

			loadSchedules() {
        		// â¬‡ å–å¾— users/test/202503_schedules
        		db.ref("users/test/202503_schedules").on("value", (snapshot) => {
          			const raw = snapshot.val();

          			if (!raw) return;

					// ðŸ”¥ é‡è¦ï¼šä½ çš„è³‡æ–™æ˜¯å­—ä¸² â†’ è½‰ JSON
					let parsed = JSON.parse(raw);

					// å–å‡º data[]
					let list = parsed.data || [];

					// è½‰æˆ FullCalendar æ ¼å¼
					let events = list.map(item => ({
						id: item.id,
						title: item.name + "ï¼š" + item.content,
						start: item.start,
						end: item.end
					}));

					console.log(events);

					this.renderCalendar(events);
				});
			},

			renderCalendar(events) {
				let calEl = document.getElementById("calendar");
				calEl.innerHTML = ""; // æ¸…é™¤èˆŠæ—¥æ›†

				let calendar = new FullCalendar.Calendar(calEl, {
			  		initialView: "dayGridMonth",
			  		locale: "zh-tw",
			  		events: events,
			  		height: "auto",
			  		eventClick(info) {
			    		alert("äº‹ä»¶ï¼š" + info.event.title);
			  		}
				});

				calendar.render();
			}
		},
		mounted() {
			this.loadSchedules();
			// var calendar = new FullCalendar.Calendar(document.getElementById('calendar'), {
			// 	initialView: 'dayGridMonth',
			// 	dateClick: function(info) {
			// 		alert('Clicked: ' + info.dateStr);
			// 	},
			// 	events: [
			// 		{ title: 'äº‹ä»¶ A', date: '2025-01-01' },
			// 		{ title: 'äº‹ä»¶ B', date: '2025-01-15' }
			// 	]
			// });
			// calendar.render();
		}
	});
</script>

</body>
</html>
